<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stream Player</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/openplayerjs/2.9.2/openplayer.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/openplayerjs/2.9.2/openplayer.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0f0f0f;
      --surface: #1a1a1a;
      --surface2: #272727;
      --border: #3d3d3d;
      --text: #f1f1f1;
      --text2: #aaaaaa;
      --red: #ff0000;
      --red-hover: #cc0000;
    }

    html, body {
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
    }

    /* â”€â”€ TOP NAV â”€â”€ */
    nav {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--bg);
      border-bottom: 1px solid #222;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      gap: 16px;
    }

    .nav-logo {
      display: flex;
      align-items: center;
      gap: 4px;
      text-decoration: none;
      flex-shrink: 0;
    }

    .nav-logo svg { width: 90px; height: 20px; }

    .nav-search {
      display: flex;
      flex: 1;
      max-width: 600px;
      height: 36px;
    }

    .nav-search input {
      flex: 1;
      background: #121212;
      border: 1px solid var(--border);
      border-right: none;
      border-radius: 40px 0 0 40px;
      padding: 0 16px;
      color: var(--text);
      font-size: 16px;
      font-family: 'Roboto', sans-serif;
      outline: none;
    }

    .nav-search input:focus {
      border-color: #1c62b9;
      background: var(--bg);
    }

    .nav-search input::placeholder { color: var(--text2); }

    .nav-search button {
      width: 64px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 0 40px 40px 0;
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s;
      flex-shrink: 0;
    }

    .nav-search button:hover { background: #3d3d3d; }

    .nav-search button svg { width: 20px; height: 20px; fill: var(--text); }

    /* â”€â”€ LAYOUT â”€â”€ */
    .page {
      max-width: 1280px;
      margin: 0 auto;
      padding: 20px 24px;
      display: grid;
      grid-template-columns: 1fr 402px;
      gap: 24px;
    }

    @media (max-width: 1000px) {
      .page { grid-template-columns: 1fr; padding: 12px; }
      .sidebar { display: none; }
    }

    /* â”€â”€ VIDEO COLUMN â”€â”€ */
    .video-col {}

    /* player shell */
    .player-shell {
      width: 100%;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }

    /* LANDING: no URL */
    .paste-box {
      aspect-ratio: 16/9;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      background: #000;
      border-radius: 12px;
    }

    .paste-box svg { width: 64px; height: 64px; fill: #555; }

    .paste-box p {
      color: var(--text2);
      font-size: 15px;
    }

    .paste-input-row {
      display: flex;
      width: 100%;
      max-width: 520px;
      gap: 0;
    }

    .paste-input-row input {
      flex: 1;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-right: none;
      border-radius: 4px 0 0 4px;
      padding: 10px 14px;
      color: var(--text);
      font-size: 14px;
      font-family: 'Roboto', sans-serif;
      outline: none;
    }

    .paste-input-row input:focus { border-color: #3ea6ff; }
    .paste-input-row input::placeholder { color: #666; }

    .paste-input-row button {
      background: #3ea6ff;
      border: none;
      border-radius: 0 4px 4px 0;
      padding: 0 20px;
      color: #0f0f0f;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      font-family: 'Roboto', sans-serif;
      white-space: nowrap;
      transition: background 0.15s;
    }

    .paste-input-row button:hover { background: #65b8ff; }

    /* video element */
    #media-player {
      width: 100%;
      display: block;
      max-height: 70vh;
      background: #000;
    }

    /* OpenPlayer overrides */
    .op-player { background: #000 !important; }
    .op-controls { background: linear-gradient(transparent, rgba(0,0,0,0.9)) !important; padding-bottom: 8px !important; }
    .op-controls__progress-played { background: var(--red) !important; }
    .op-controls__progress-thumb { background: var(--red) !important; }
    .op-controls__progress-buffered { background: rgba(255,255,255,0.2) !important; }

    /* â”€â”€ VIDEO INFO â”€â”€ */
    .video-info { padding: 12px 0 0; }

    .video-title {
      font-size: 20px;
      font-weight: 600;
      line-height: 1.3;
      color: var(--text);
      margin-bottom: 8px;
      word-break: break-word;
    }

    .video-meta-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 8px;
      padding-bottom: 12px;
      border-bottom: 1px solid #3d3d3d;
    }

    .video-views {
      color: var(--text2);
      font-size: 14px;
    }

    .action-btns {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .action-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--surface2);
      border: none;
      border-radius: 18px;
      padding: 8px 14px;
      color: var(--text);
      font-size: 14px;
      font-family: 'Roboto', sans-serif;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s;
      text-decoration: none;
    }

    .action-btn:hover { background: #3d3d3d; }
    .action-btn svg { width: 18px; height: 18px; fill: var(--text); flex-shrink: 0; }

    .action-btn.red {
      background: var(--red);
      color: #fff;
    }
    .action-btn.red:hover { background: var(--red-hover); }
    .action-btn.red svg { fill: #fff; }

    .action-btn.copied {
      background: #2a9d3e;
      color: #fff;
    }

    /* channel row */
    .channel-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid #3d3d3d;
    }

    .channel-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--red);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 16px;
      flex-shrink: 0;
    }

    .channel-name {
      font-weight: 500;
      font-size: 15px;
    }

    .channel-subs {
      color: var(--text2);
      font-size: 12px;
      margin-top: 2px;
    }

    /* description box */
    .desc-box {
      background: var(--surface2);
      border-radius: 12px;
      padding: 12px;
      margin-top: 12px;
      font-size: 14px;
      line-height: 1.6;
      color: var(--text2);
      word-break: break-all;
    }

    .desc-box .desc-url {
      color: #3ea6ff;
      font-size: 12px;
      font-family: monospace;
    }

    /* â”€â”€ SIDEBAR â”€â”€ */
    .sidebar {}

    .sidebar-title {
      font-size: 15px;
      font-weight: 500;
      margin-bottom: 12px;
      color: var(--text2);
    }

    .tip-card {
      background: var(--surface2);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 10px;
      font-size: 13px;
      color: var(--text2);
      line-height: 1.6;
    }

    .tip-card strong { color: var(--text); display: block; margin-bottom: 4px; }

    /* â”€â”€ ANIMATIONS â”€â”€ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .fadein { animation: fadeIn 0.3s ease both; }

    /* â”€â”€ MOBILE â”€â”€ */
    @media (max-width: 600px) {
      nav { padding: 0 8px; }
      .nav-search { max-width: unset; }
      .page { padding: 0; gap: 0; }
      .player-shell { border-radius: 0; }
      .video-info { padding: 12px; }
    }
  </style>
</head>
<body>

<!-- NAV -->
<nav>
  <a class="nav-logo" href="/" title="Stream Player">
    <!-- YouTube-style wordmark SVG -->
    <svg viewBox="0 0 90 20" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect x="0" y="2" width="28" height="16" rx="4" fill="#FF0000"/>
      <polygon points="11,6 11,14 19,10" fill="white"/>
      <text x="32" y="15" font-family="Roboto,sans-serif" font-weight="700" font-size="13" fill="#f1f1f1">StreamPlay</text>
    </svg>
  </a>

  <div class="nav-search">
    <input id="nav-input" type="url" placeholder="Paste a direct media URLâ€¦" autocomplete="off" spellcheck="false" />
    <button id="nav-play-btn" title="Play">
      <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    </button>
  </div>
</nav>

<!-- PAGE -->
<div class="page" id="page">
  <!-- filled by JS -->
</div>

<script>
(function () {
  const page = document.getElementById('page');
  const navInput = document.getElementById('nav-input');
  const navBtn   = document.getElementById('nav-play-btn');

  // â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getParam(name) {
    return new URLSearchParams(window.location.search).get(name);
  }

  function fileName(url) {
    try {
      const parts = decodeURIComponent(new URL(url).pathname).split('/');
      return parts[parts.length - 1] || 'media';
    } catch { return 'media'; }
  }

  function fileExt(url) {
    const n   = fileName(url);
    const dot = n.lastIndexOf('.');
    return dot !== -1 ? n.slice(dot + 1).toLowerCase() : '';
  }

  function isAudio(url) {
    return ['mp3','aac','ogg','flac','wav','opus','m4a'].includes(fileExt(url));
  }

  function stripExt(name) {
    const dot = name.lastIndexOf('.');
    return dot !== -1 ? name.slice(0, dot) : name;
  }

  function navigate(url) {
    const u = new URL(window.location.href);
    u.searchParams.set('url', url);
    window.location.href = u.toString();
  }

  // nav bar play
  navBtn.addEventListener('click', () => {
    const v = navInput.value.trim();
    if (v) navigate(v);
    else navInput.focus();
  });
  navInput.addEventListener('keydown', e => { if (e.key === 'Enter') navBtn.click(); });

  // â”€â”€ LANDING page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderLanding() {
    page.innerHTML = `
      <div style="grid-column:1/-1" class="fadein">
        <div class="paste-box">
          <svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-9 8l-5 3V8l5 3zm5 3l-5-3 5-3v6z"/></svg>
          <p>Paste a direct media link above and press â–¶ to stream</p>
          <div class="paste-input-row">
            <input id="lp-input" type="url" placeholder="https://example.com/video.mp4" autocomplete="off" spellcheck="false"/>
            <button id="lp-btn">â–¶ Play</button>
          </div>
        </div>
      </div>
    `;
    const inp = document.getElementById('lp-input');
    const btn = document.getElementById('lp-btn');
    btn.addEventListener('click', () => { if (inp.value.trim()) navigate(inp.value.trim()); else inp.focus(); });
    inp.addEventListener('keydown', e => { if (e.key === 'Enter') btn.click(); });
    inp.focus();
  }

  // â”€â”€ PLAYER page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderPlayer(url) {
    navInput.value = url;
    const name    = fileName(url);
    const title   = stripExt(name).replace(/%20/g, ' ').replace(/_/g, ' ');
    const ext     = fileExt(url).toUpperCase() || 'VIDEO';
    const audio   = isAudio(url);
    const tag     = audio ? 'audio' : 'video';
    const initial = title.trim().charAt(0).toUpperCase() || 'S';

    page.innerHTML = `
      <!-- VIDEO COLUMN -->
      <div class="video-col fadein">

        <div class="player-shell">
          <${tag} id="media-player" class="op-player__media" controls preload="metadata" ${audio ? '' : 'playsinline'}>
            <source src="${url}" />
          </${tag}>
        </div>

        <div class="video-info">
          <div class="video-title" id="vid-title">${title}</div>

          <div class="video-meta-row">
            <span class="video-views" id="vid-meta">${ext} file</span>
            <div class="action-btns">
              <a class="action-btn red" href="${url}" download target="_blank" rel="noopener">
                <svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zm7-18l-5 5h3v6h4v-6h3l-5-5z" transform="rotate(180,12,12)"/></svg>
                Download
              </a>
              <button class="action-btn" id="copy-btn">
                <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                Copy Link
              </button>
              <button class="action-btn" id="new-btn">
                <svg viewBox="0 0 24 24"><path d="M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42-.39-.39-1.02-.39-1.41 0l-6.59 6.59c-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1z"/></svg>
                New URL
              </button>
            </div>
          </div>

          <div class="channel-row">
            <div class="channel-avatar">${initial}</div>
            <div>
              <div class="channel-name">Direct Stream</div>
              <div class="channel-subs">via StreamPlay</div>
            </div>
          </div>

          <div class="desc-box">
            <strong style="color:#f1f1f1;display:block;margin-bottom:6px;">Source URL</strong>
            <span class="desc-url">${url}</span>
          </div>
        </div>
      </div>

      <!-- SIDEBAR -->
      <div class="sidebar fadein">
        <div class="sidebar-title">Tips</div>
        <div class="tip-card">
          <strong>ğŸ“º Streaming</strong>
          Paste any direct .mp4, .mkv, .webm, .mp3 or .m3u8 link and it will play instantly in the browser.
        </div>
        <div class="tip-card">
          <strong>â¬‡ï¸ Download</strong>
          Click the red Download button to save the file directly to your device.
        </div>
        <div class="tip-card">
          <strong>ğŸ“‹ Copy Link</strong>
          Copies the raw direct URL to your clipboard so you can share or open in VLC / MX Player.
        </div>
        <div class="tip-card">
          <strong>ğŸµ Audio files</strong>
          MP3, AAC, FLAC, OGG and other audio formats are fully supported too.
        </div>
      </div>
    `;

    // copy button
    document.getElementById('copy-btn').addEventListener('click', function () {
      navigator.clipboard.writeText(url).then(() => {
        this.textContent = 'âœ“ Copied!';
        this.classList.add('copied');
        setTimeout(() => {
          this.innerHTML = `<svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:var(--text);flex-shrink:0"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg> Copy Link`;
          this.classList.remove('copied');
        }, 2000);
      });
    });

    // new url button
    document.getElementById('new-btn').addEventListener('click', () => {
      const u = new URL(window.location.href);
      u.searchParams.delete('url');
      window.location.href = u.toString();
    });

    // OpenPlayerJS init
    try {
      const player = new OpenPlayer('media-player', {
        controls: {
          layers: {
            left:   ['play', 'time', 'volume'],
            middle: ['progress'],
            right:  ['captions', 'settings', 'fullscreen'],
          }
        }
      });
      player.init();

      // try to get duration for meta
      const el = document.getElementById('media-player');
      el.addEventListener('loadedmetadata', () => {
        const dur = el.duration;
        if (dur && isFinite(dur)) {
          const m = Math.floor(dur / 60);
          const s = Math.floor(dur % 60).toString().padStart(2, '0');
          document.getElementById('vid-meta').textContent = `${ext} Â· ${m}:${s}`;
        }
      });
    } catch(e) {
      console.warn('OpenPlayer init:', e);
    }
  }

  // â”€â”€ router â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const url = getParam('url');
  if (!url) {
    renderLanding();
  } else {
    try { new URL(url); renderPlayer(url); }
    catch { renderLanding(); }
  }

})();
</script>
</body>
</html>
